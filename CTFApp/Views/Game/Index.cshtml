@model List<User>

@{
	ViewBag.Title = "CTF Game";
}

<div id="game-container">
	<h2>Simple CTF Game</h2>
	<label>Enter Name:</label>
	<input type="text" id="userName" placeholder="Your Name">
	<p>Click the button as fast as you can!</p>
	<button id="startGame">Start Game</button>
	<button id="clickButton" style="display: none;">Click Me!</button>
	<p id="scoreDisplay"></p>
	<button id="submitScore" style="display: none;">Submit Score</button>
</div>

<table>
	<thead>
		<tr>
			<th>ID</th>
			<th>Username</th>
			<th>Score</th>
		</tr>
	</thead>
	<tbody>
		@foreach (var user in Model)
		{
			<tr>
				<td>@user.userName</td> @* Ensure this matches the actual property name *@
				<td>@user.userScore</td> @* Ensure this matches the actual property name *@
			</tr>
		}
	</tbody>
</table>

@section Scripts {
	<script>
		let score = 0;
		let gameActive = false;
		let startTime;

		document.getElementById("startGame").addEventListener("click", function () {
			// Automatically submit the score after 5 seconds
			const userName = document.getElementById("userName").value;
			if (!userName) {
				alert("Please enter your name.");
				return;
			}
			score = 0;
			gameActive = true;
			document.getElementById("clickButton").style.display = "inline-block";
			document.getElementById("scoreDisplay").innerText = "Score: 0";
			document.getElementById("startGame").style.display = "none";

			startTime = new Date().getTime();
		});

		document.getElementById("clickButton").addEventListener("click", function () {
			if (gameActive) {
				score++;
				document.getElementById("scoreDisplay").innerText = "Score: " + score;

				// Stop game after 5 seconds
				if (new Date().getTime() - startTime > 5000) {
					gameActive = false;
					alert(`Congratulations! You Have Scored ${score}`);
					document.getElementById("clickButton").style.display = "none";



					const userData = {
						UserName: document.getElementById("userName").value,
						UserScore: score
					};

					fetch("/api/game/submitscore", {
						method: "POST",
						headers: {
							"Content-Type": "application/json"
						},
						body: JSON.stringify(userData)
					})
					.catch(error => {
						console.error("Error:", error);
						alert("Failed to submit score.");
					});
				}
			}
		});





	</script>
}
